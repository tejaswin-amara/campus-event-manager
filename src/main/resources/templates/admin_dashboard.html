<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampusConnect - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" th:href="@{/css/style.css?v=3}">
    <link rel="icon" type="image/svg+xml" th:href="@{/favicon.svg}">
    <script th:src="@{/js/main.js}" defer></script>
    <!-- SEO & Social Meta Tags -->
    <meta property="og:title" content="CampusConnect - Admin Control Center">
    <meta property="og:description" content="Manage and analyze campus events with ease.">
    <meta property="og:type" content="website">
</head>

<body>
    <!-- Hidden inputs for Premium Toast Notifications -->
    <input type="hidden" id="flashSuccessMsg" th:value="${success}">
    <input type="hidden" id="flashErrorMsg" th:value="${error}">

    <!-- ðŸ“± Mobile Header (Visible < 992px) -->
    <header class="mobile-header d-lg-none glass">
        <div class="d-flex align-items-center gap-2">
            <button class="btn btn-link text-white p-0" onclick="toggleSidebar()" aria-label="Open Navigation Menu">
                <i class="bi bi-list fs-1" aria-hidden="true"></i>
            </button>
            <span class="fs-5 fw-bold text-white tracking-wide ms-2">CampusConnect</span>
        </div>
        <div class="rounded-circle bg-gradient d-flex align-items-center justify-content-center"
            style="width: 32px; height: 32px; background: rgba(99, 102, 241, 0.2); color: #a5b4fc;">
            <span th:text="${#strings.substring(user.username,0,1).toUpperCase()}">A</span>
        </div>
    </header>

    <!-- ðŸŒ‘ Sidebar Overlay (Mobile) -->
    <div class="sidebar-overlay" onclick="toggleSidebar()" id="sidebarOverlay"></div>

    <div class="app-container">
        <!-- ðŸ§Š Sidebar (Fixed Desktop / Offcanvas Mobile) -->
        <nav class="sidebar" id="sidebar">
            <!-- Brand (Desktop) -->
            <div class="mb-5 d-none d-lg-block px-2 text-center text-lg-start">
                <img th:src="@{/images/logo.png}" alt="CampusConnect" class="brand-logo d-block">
            </div>

            <!-- Nav Links -->
            <ul class="nav flex-column mb-auto">
                <li class="nav-item">
                    <a href="#" class="nav-link active" onclick="filterCategory('all', this)">
                        <i class="bi bi-grid-fill"></i> All Events
                    </a>
                </li>
                <!-- Time Filters -->
                <li class="nav-item">
                    <span class="text-muted small text-uppercase px-3 fw-bold mt-4 mb-2 d-block"
                        style="font-size: 0.7rem;">Time</span>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="filterStatus('Upcoming', this)">
                        <i class="bi bi-calendar-check text-green"></i> Upcoming
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="filterStatus('Ongoing', this)">
                        <i class="bi bi-broadcast text-blue"></i> Ongoing
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="filterStatus('Past', this)">
                        <i class="bi bi-clock-history text-muted"></i> Past
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#addEventModal">
                        <i class="bi bi-plus-circle-fill text-gradient"></i> Create Event
                    </a>
                </li>
            </ul>

            <!-- User Profile (Sign Out Only) -->
            <div class="mt-auto border-top border-secondary pt-3" style="border-color: var(--border-glass) !important;">
                <a th:href="@{/logout}" class="nav-link text-danger">
                    <i class="bi bi-box-arrow-right"></i> Sign Out
                </a>
            </div>
        </nav>

        <!-- ðŸš€ Main Content -->
        <main class="main-content">

            <!-- Dashboard Title Area -->
            <div
                class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3 animate-in">
                <div>
                    <h2 class="fw-bold mb-1">Overview</h2>
                    <p class="text-muted small mb-0">Manage events and view analytics.</p>
                </div>

                <!-- Search & Actions (Responsive) -->
                <div class="d-flex flex-column flex-sm-row gap-2 w-100" style="max-width: 450px;">
                    <div class="position-relative flex-grow-1">
                        <i class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"></i>
                        <input type="text" id="searchInput" class="form-control ps-5 rounded-pill"
                            placeholder="Search events..." aria-label="Search events to manage">
                    </div>
                    <a th:href="@{/admin/export-events}"
                        class="btn btn-export rounded-pill px-4 flex-shrink-0 text-decoration-none d-flex align-items-center justify-content-center">
                        <i class="bi bi-file-earmark-spreadsheet me-2"></i> Export CSV
                    </a>
                </div>
            </div>

            <!-- ðŸ“Š Stats & Charts Grid -->
            <div class="row g-4 mb-4 animate-in" style="animation-delay: 0.05s;">
                <!-- Stats Cards Column -->
                <div class="col-lg-8">
                    <div class="row g-3 h-100">
                        <!-- Total -->
                        <div class="col-md-4">
                            <div class="glass-card h-100 d-flex flex-column justify-content-center">
                                <span class="text-muted text-uppercase small fw-bold mb-1">Total Events</span>
                                <h2 class="fw-bold mb-0" th:text="${totalEvents}">0</h2>
                            </div>
                        </div>
                        <!-- Upcoming -->
                        <div class="col-md-4">
                            <div class="glass-card h-100 d-flex flex-column justify-content-center"
                                style="background: linear-gradient(145deg, rgba(16, 185, 129, 0.05) 0%, rgba(16, 185, 129, 0.01) 100%); border-color: rgba(16, 185, 129, 0.2);">
                                <span class="text-green text-uppercase small fw-bold mb-1">Upcoming</span>
                                <h2 class="fw-bold text-white mb-0" th:text="${upcomingEvents}">0</h2>
                            </div>
                        </div>
                        <!-- Past -->
                        <div class="col-md-4">
                            <div class="glass-card h-100 d-flex flex-column justify-content-center">
                                <span class="text-muted text-uppercase small fw-bold mb-1">Past Events</span>
                                <h2 class="fw-bold text-muted mb-0" th:text="${pastEvents}">0</h2>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ðŸ“ˆ Analytics Chart Column (Moved from Sidebar!) -->
                <div class="col-lg-4">
                    <div class="glass-card h-100 d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <span class="text-muted small fw-bold text-uppercase">Distribution</span>
                            <i class="bi bi-pie-chart-fill text-primary"></i>
                        </div>
                        <div class="flex-grow-1 position-relative" style="min-height: 150px;">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ðŸ“‹ Data Table (Responsive Wrapper) -->
            <div class="glass-card p-0 overflow-hidden animate-in" style="animation-delay: 0.1s;">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 align-middle" id="eventsTable">
                        <thead class="bg-surface">
                            <tr>
                                <th class="ps-4" style="width: 40px;">#</th>
                                <th style="min-width: 150px;">Title</th>
                                <th style="min-width: 100px;">Category</th>
                                <th style="min-width: 160px;">Date & Time</th>
                                <th style="min-width: 120px;">Venue</th>
                                <th style="min-width: 90px;">Status</th>
                                <th class="text-end pe-4" style="min-width: 90px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Event Row -->
                            <tr th:each="event, stat : ${events}" class="align-middle fade-in"
                                th:data-category="${event.category}"
                                th:data-status="${event.dateTime.isAfter(now)} ? 'Upcoming' : (${event.endDateTime != null && event.endDateTime.isAfter(now)} ? 'Ongoing' : 'Past')">
                                <td class="ps-4 text-muted" th:text="${stat.index + 1}">1</td>
                                <td>
                                    <div class="fw-bold text-white text-truncate" style="max-width: 200px;"
                                        th:text="${event.title}">Title</div>
                                </td>
                                <td>
                                    <span class="badge-pill"
                                        th:classappend="${event.category == 'Technical'} ? 'badge-tech' : (${event.category == 'Cultural'} ? 'badge-cultural' : (${event.category == 'Sports'} ? 'badge-sports' : (${event.category == 'Workshop'} ? 'badge-workshop' : (${event.category == 'Seminar'} ? 'badge-seminar' : 'glass'))))"
                                        th:text="${event.category}">Category</span>
                                </td>
                                <td>
                                    <div class="d-flex flex-column" style="line-height: 1.3;">
                                        <div class="small fw-semibold text-white"
                                            th:text="${#temporals.format(event.dateTime, 'MMM dd, yyyy')}">Date</div>

                                        <!-- Handle optional end date (if different) -->
                                        <div class="small text-muted"
                                            th:if="${event.endDateTime != null && !event.endDateTime.toLocalDate().isEqual(event.dateTime.toLocalDate())}"
                                            th:text="'to ' + ${#temporals.format(event.endDateTime, 'MMM dd, yyyy')}">to
                                            Date</div>

                                        <div class="small text-muted"
                                            th:text="${#temporals.format(event.dateTime, 'h:mm a')}">Time</div>
                                    </div>
                                </td>
                                <td>
                                    <div class="text-truncate text-white" style="max-width: 120px;"
                                        th:text="${event.venue}">Venue
                                    </div>
                                </td>
                                <td>
                                    <span class="badge-pill glass border-0"
                                        style="font-size: 0.7rem; padding: 0.2em 0.6em;"
                                        th:classappend="${event.dateTime.isAfter(now)} ? 'text-green' : (${event.endDateTime != null && event.endDateTime.isAfter(now)} ? 'text-blue' : 'text-muted')"
                                        th:text="${event.dateTime.isAfter(now)} ? 'Upcoming' : (${event.endDateTime != null && event.endDateTime.isAfter(now)} ? 'Ongoing' : 'Past')">Status</span>
                                </td>
                                <td class="text-end pe-4">
                                    <div class="btn-group btn-group-sm">
                                        <button type="button" class="btn btn-dark border-0 text-muted hover-white"
                                            onclick="openEditModal(this)" th:data-id="${event.id}"
                                            th:data-title="${event.title}" th:data-category="${event.category}"
                                            th:data-datetime="${event.dateTime}"
                                            th:data-enddatetime="${event.endDateTime}" th:data-venue="${event.venue}"
                                            th:data-link="${event.registrationLink}" th:data-desc="${event.description}"
                                            th:data-image="${event.imageUrl}" th:data-responses="${event.responsesLink}"
                                            th:data-capacity="${event.maxCapacity}" title="Edit"
                                            aria-label="Edit this event">
                                            <i class="bi bi-pencil-square"></i>
                                        </button>
                                        <button type="button" class="btn btn-dark border-0 text-muted hover-danger"
                                            data-bs-toggle="modal" data-bs-target="#deleteEventModal"
                                            th:onclick="'setDeleteId(' + ${event.id} + ')'" title="Delete"
                                            aria-label="Delete this event">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <!-- Empty State -->
                            <tr th:if="${#lists.isEmpty(events)}">
                                <td colspan="7" class="text-center py-5">
                                    <div class="py-4">
                                        <i class="bi bi-inbox fs-1 text-muted opacity-25"></i>
                                        <p class="text-muted mt-2">No events found. Create one to get started!</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- âž• Create Event Modal -->
    <div class="modal fade" id="addEventModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content glass">
                <div class="modal-header border-bottom border-secondary"
                    style="border-color: var(--border-glass) !important;">
                    <h5 class="modal-title fw-bold">Create New Event</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close Create Event Modal"></button>
                </div>
                <div class="modal-body">
                    <form th:action="@{/admin/add-event}" method="post" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label class="form-label small text-muted text-uppercase fw-bold">Title</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="form-label small text-muted text-uppercase fw-bold">Category</label>
                                <select class="form-select bg-dark text-white border-secondary" name="category" required
                                    style="background-color: var(--bg-surface) !important; border-color: var(--border-glass) !important;">
                                    <option value="Technical">Technical</option>
                                    <option value="Cultural">Cultural</option>
                                    <option value="Sports">Sports</option>
                                    <option value="Workshop">Workshop</option>
                                    <option value="Seminar">Seminar</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small text-muted text-uppercase fw-bold">Venue</label>
                                <input type="text" class="form-control" name="venue" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted text-uppercase fw-bold">Description</label>
                            <textarea class="form-control" name="description" rows="3" required></textarea>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-6">
                                <label class="form-label small text-muted text-uppercase fw-bold">Start Date &
                                    Time</label>
                                <input type="datetime-local" class="form-control" name="dateTime" required>
                            </div>
                            <div class="col-6">
                                <label class="form-label small text-muted text-uppercase fw-bold">End Date &
                                    Time</label>
                                <input type="datetime-local" class="form-control" name="endDateTime">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted text-uppercase fw-bold">Registration Link</label>
                            <input type="url" class="form-control" name="registrationLink">
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted text-uppercase fw-bold">Max Capacity</label>
                            <input type="number" class="form-control" name="maxCapacity" min="1"
                                placeholder="Leave blank for unlimited">
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted text-uppercase fw-bold">Responses Link</label>
                            <input type="url" class="form-control" name="responsesLink">
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted text-uppercase fw-bold">Event Banner</label>
                            <input type="file" class="form-control" name="imageFile" accept="image/*">
                        </div>
                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-action justify-content-center">Create Event</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- âœï¸ Edit Event Modal -->
    <div class="modal fade" id="editEventModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content glass">
                <div class="modal-header border-bottom border-secondary"
                    style="border-color: var(--border-glass) !important;">
                    <h5 class="modal-title fw-bold">Edit Event</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close Edit Event Modal"></button>
                </div>
                <div class="modal-body">
                    <form th:action="@{/admin/edit-event}" method="post" enctype="multipart/form-data">
                        <input type="hidden" id="editId" name="id">

                        <!-- Similar fields to Create -->
                        <div class="mb-3">
                            <label class="form-label small text-muted text-uppercase fw-bold">Title</label>
                            <input type="text" class="form-control" id="editTitle" name="title" required>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="form-label small text-muted text-uppercase fw-bold">Category</label>
                                <select class="form-select bg-dark text-white border-secondary" id="editCategory"
                                    name="category" required
                                    style="background-color: var(--bg-surface) !important; border-color: var(--border-glass) !important;">
                                    <option value="Technical">Technical</option>
                                    <option value="Cultural">Cultural</option>
                                    <option value="Sports">Sports</option>
                                    <option value="Workshop">Workshop</option>
                                    <option value="Seminar">Seminar</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label small text-muted text-uppercase fw-bold">Venue</label>
                                <input type="text" class="form-control" id="editVenue" name="venue" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted text-uppercase fw-bold">Description</label>
                            <textarea class="form-control" id="editDesc" name="description" rows="3"
                                required></textarea>
                        </div>
                        <div class="row g-3 mb-3">
                            <div class="col-6">
                                <label class="form-label small text-muted text-uppercase fw-bold">Start</label>
                                <input type="datetime-local" class="form-control" id="editDateTime" name="dateTime"
                                    required>
                            </div>
                            <div class="col-6">
                                <label class="form-label small text-muted text-uppercase fw-bold">End</label>
                                <input type="datetime-local" class="form-control" id="editEndDateTime"
                                    name="endDateTime">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted text-uppercase fw-bold">Registration Link</label>
                            <input type="url" class="form-control" id="editLink" name="registrationLink">
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted text-uppercase fw-bold">Max Capacity</label>
                            <input type="number" class="form-control" id="editCapacity" name="maxCapacity" min="1"
                                placeholder="Leave blank for unlimited">
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted text-uppercase fw-bold">Responses Link</label>
                            <input type="url" class="form-control" id="editResponsesLink" name="responsesLink">
                        </div>
                        <div class="mb-3">
                            <label class="form-label small text-muted text-uppercase fw-bold">Change Image
                                (Optional)</label>
                            <input type="file" class="form-control" name="imageFile" accept="image/*">
                        </div>
                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-action justify-content-center">Update Event</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ðŸ—‘ï¸ Delete Confirmation Modal -->
    <div class="modal fade" id="deleteEventModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content glass border-danger bg-dark">
                <div class="modal-body text-center p-5">
                    <div class="rounded-circle bg-danger bg-opacity-10 mx-auto mb-4 d-flex align-items-center justify-content-center"
                        style="width: 64px; height: 64px;">
                        <i class="bi bi-exclamation-triangle-fill text-danger fs-3"></i>
                    </div>
                    <h4 class="fw-bold mb-2">Delete Event?</h4>
                    <p class="text-muted mb-4">This action cannot be undone. Are you sure you want to delete this event?
                    </p>
                    <div class="d-flex justify-content-center gap-3">
                        <button type="button" class="btn btn-outline-secondary px-4 text-white"
                            data-bs-dismiss="modal">Cancel</button>
                        <a id="confirmDeleteBtn" href="#" class="btn btn-danger px-4">Delete Event</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // ðŸ“± Sidebar Toggle Function
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('show');
            overlay.classList.toggle('show');
        }

        // ðŸ” Search Functionality
        document.getElementById('searchInput').addEventListener('input', function () {
            let filter = this.value.toLowerCase();
            let rows = document.querySelectorAll('#eventsTable tbody tr');

            rows.forEach(row => {
                let text = row.innerText.toLowerCase();
                row.style.display = text.includes(filter) ? '' : 'none';
            });
        });

        // ðŸ·ï¸ Category Filter
        function filterCategory(category, btn) {
            // Update Active State
            document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
            btn.classList.add('active');

            if (window.innerWidth < 992) toggleSidebar();

            let rows = document.querySelectorAll('#eventsTable tbody tr');
            rows.forEach(row => {
                let rowCategory = row.getAttribute('data-category');
                // Handle empty rows or rows without category (like the 'No events found' row)
                if (!rowCategory) return;

                if (category === 'all' || rowCategory === category) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // â³ Status Filter
        function filterStatus(status, btn) {
            // Update Active State
            document.querySelectorAll('.sidebar .nav-link').forEach(l => l.classList.remove('active'));
            btn.classList.add('active');

            if (window.innerWidth < 992) toggleSidebar();

            let rows = document.querySelectorAll('#eventsTable tbody tr');
            rows.forEach(row => {
                let rowStatus = row.getAttribute('data-status');
                // Handle empty rows
                if (!rowStatus) return;

                if (rowStatus === status) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // ðŸ“ Edit Modal Populate
        const editModal = new bootstrap.Modal(document.getElementById('editEventModal'));
        function openEditModal(btn) {
            document.getElementById('editId').value = btn.dataset.id;
            document.getElementById('editTitle').value = btn.dataset.title;
            document.getElementById('editCategory').value = btn.dataset.category;
            document.getElementById('editVenue').value = btn.dataset.venue;
            document.getElementById('editDesc').value = btn.dataset.desc;
            document.getElementById('editDateTime').value = btn.dataset.datetime;
            document.getElementById('editEndDateTime').value = btn.dataset.enddatetime || ''; // Handle null safely
            document.getElementById('editLink').value = btn.dataset.link || '';
            document.getElementById('editResponsesLink').value = btn.dataset.responses || '';
            document.getElementById('editCapacity').value = btn.dataset.capacity || '';

            editModal.show();
        }

        // ðŸ—‘ï¸ Delete Logic
        function setDeleteId(id) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/admin/delete-event/' + id;
            form.style.display = 'none';
            document.body.appendChild(form);
            document.getElementById('confirmDeleteBtn').onclick = (e) => {
                e.preventDefault();
                form.submit();
            };
        }

        // ðŸ“Š Chart Logic
        document.addEventListener('DOMContentLoaded', function () {
            const ctx = document.getElementById('categoryChart');
            if (ctx) {
                // Get data from Thymeleaf logic or calculate from table if not passed explicitly.
                // For simplicity, we'll scrape the table badge counts as we did before, or use Thymeleaf variables if available.
                // Let's scrape for robust client-side count regardless of model.

                const counts = { 'Technical': 0, 'Cultural': 0, 'Sports': 0, 'Workshop': 0, 'Seminar': 0 };
                document.querySelectorAll('#eventsTable tbody tr').forEach(row => {
                    const cat = row.getAttribute('data-category'); // Ensure tr has this attribute
                    if (cat && counts[cat] !== undefined) counts[cat]++;
                });

                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(counts),
                        datasets: [{
                            data: Object.values(counts),
                            backgroundColor: [
                                'rgba(99, 102, 241, 0.8)',  // Tech (Indigo)
                                'rgba(236, 72, 153, 0.8)',  // Cultural (Pink)
                                'rgba(245, 158, 11, 0.8)',  // Sports (Orange)
                                'rgba(16, 185, 129, 0.8)',  // Workshop (Green)
                                'rgba(6, 182, 212, 0.8)'    // Seminar (Cyan)
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: { color: '#a1a1aa', usePointStyle: true, boxWidth: 8 }
                            }
                        },
                        cutout: '75%'
                    }
                });
            }
        });
    </script>
</body>

</html>